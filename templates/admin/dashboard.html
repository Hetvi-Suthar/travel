{% extends "admin/adminlayout.html" %}
{% block content %}

<!-- start: content -->
<div id="content" class="container-fluid py-4">

  <!-- Dashboard Header -->
  <div class="row mb-4">
    <div class="col-md-6">
      <h3 class="animated fadeInLeft">Admin Dashboard</h3>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="row mb-4">
    <!-- Total Users -->
    <div class="col-sm-6 col-md-3 mb-3">
      <div class="card shadow-sm text-center h-100 p-3">
        <h5 class="card-title">Total Users</h5>
        <h2 class="card-text display-5">{{ total_users }}</h2>
        <p class="text-muted">User active</p>
      </div>
    </div>

    <!-- Total Bookings -->
    <div class="col-sm-6 col-md-3 mb-3">
      <div class="card shadow-sm text-center h-100 p-3">
        <h5 class="card-title">Total Bookings</h5>
        <h2 class="card-text display-5">{{ total_bookings }}</h2>
        <p class="text-muted">New Orders</p>
      </div>
    </div>

    <!-- Active Packages -->
    <div class="col-sm-6 col-md-3 mb-3">
      <div class="card shadow-sm text-center h-100 p-3">
        <h5 class="card-title">Active Packages</h5>
        <h2 class="card-text display-5">{{ total_packages }}</h2>
        <p class="text-muted">Packages Running</p>
      </div>
    </div>

    <!-- Total Revenue -->
    <div class="col-sm-6 col-md-3 mb-3">
      <div class="card shadow-sm text-center h-100 p-3">
        <h5 class="card-title">Total Revenue</h5>
        <h2 class="card-text display-5">â‚¹3,21,000</h2>
        <p class="text-muted">Revenue Earned</p>
      </div>
    </div>
  </div>

  <!-- Reports Overview -->
  <div class="row mb-4">
    <div class="col-md-12">
      <h4>Reports Overview</h4>
    </div>
  </div>

  <div class="row mb-4">
    <!-- Progress Cards -->
    {% set reports = [
      {'title':'Bookings Verified','value':booking_verified,'percent':booking_verified_percent,'color':'success'},
      {'title':'Pending Bookings','value':pending_bookings,'percent':pending_percent,'color':'info'},
      {'title':'Popular Package','value':popular_count,'percent':popular_percent,'color':'warning'},
      {'title':'Blocked Users','value':blocked_users,'percent':blocked_percent,'color':'danger'}
    ] %}
    {% for report in reports %}
    <div class="col-sm-6 col-md-3 mb-3">
      <div class="card shadow-sm h-100 p-3">
        <h6>{{ report.title }}</h6>
        <p><strong>{{ report.value }}</strong></p>
        <div class="progress">
          <div class="progress-bar bg-{{ report.color }}" role="progressbar" style="width: {{ report.percent }}%" aria-valuenow="{{ report.percent }}" aria-valuemin="0" aria-valuemax="100">{{ report.percent }}%</div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Charts Section -->
  <div class="row">
    <!-- Monthly Bookings Chart -->
    <div class="col-md-6 mb-4">
      <div class="card shadow-sm h-100 p-3">
        <h5>Monthly Bookings</h5>
        <canvas class="line-chart" style="height:300px;"></canvas>
      </div>
    </div>

    <!-- Top Destinations Chart -->
    <div class="col-md-6 mb-4">
      <div class="card shadow-sm h-100 p-3 text-center">
        <h5>Top 5 Booked Destinations</h5>
        <canvas id="topDestinationPieChart" style="height:300px;width:300px;"></canvas>
      </div>
    </div>
  </div>

</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
new Chart(document.querySelector('.line-chart'), {
  type: 'line',
  data: {
    labels: {{ month_labels|tojson }},
    datasets: [{
      label: 'Bookings',
      data: {{ monthly_counts|tojson }},
      borderColor: '#3498db',
      backgroundColor: 'rgba(52,152,219,0.2)',
      fill: true,
      tension: 0.3
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { display: true }
    },
    scales: {
      y: { beginAtZero: true }
    }
  }
});

const ctx2 = document.getElementById('topDestinationPieChart').getContext('2d');
const pieChart = new Chart(ctx2, {
  type: 'pie',
  data: {
    labels: {{ top_package_names | tojson | safe }},
    datasets: [{
      label: 'Top Booked Packages',
      data: {{ top_package_counts | tojson | safe }},
      backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'],
      borderColor: '#fff',
      borderWidth: 2
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { position: 'bottom', labels: { boxWidth: 15, font: { size: 13 } } },
      tooltip: {
        callbacks: {
          label: function(context) {
            return `${context.label}: ${context.raw} bookings`;
          }
        }
      }
    }
  }
});
</script>

{% endblock %}
