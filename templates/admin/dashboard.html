{% extends "admin/adminlayout.html" %}
{% block content %}

<!-- start: content -->
<div id="content" class="container-fluid py-4">

  <!-- Dashboard Header -->
  <div class="row mb-4">
    <div class="col-md-6">
      <h3 class="animated fadeInLeft">Admin Dashboard</h3>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="row mb-4">
    <!-- Total Users -->
    <div class="col-md-3 col-sm-6 mb-3">
      <div class="card shadow-sm text-center h-100">
        <div class="card-body">
          <h5 class="card-title">Total Users</h5>
          <h2 class="card-text">{{ total_users }}</h2>
          <p class="text-muted">User active</p>
        </div>
      </div>
    </div>

    <!-- Total Bookings -->
    <div class="col-md-3 col-sm-6 mb-3">
      <div class="card shadow-sm text-center h-100">
        <div class="card-body">
          <h5 class="card-title">Total Bookings</h5>
          <h2 class="card-text">{{ total_bookings }}</h2>
          <p class="text-muted">New Orders</p>
        </div>
      </div>
    </div>

    <!-- Active Packages -->
    <div class="col-md-3 col-sm-6 mb-3">
      <div class="card shadow-sm text-center h-100">
        <div class="card-body">
          <h5 class="card-title">Active Packages</h5>
          <h2 class="card-text">{{ total_packages }}</h2>
          <p class="text-muted">Packages Running</p>
        </div>
      </div>
    </div>

    <!-- Total Revenue -->
    <div class="col-md-3 col-sm-6 mb-3">
      <div class="card shadow-sm text-center h-100">
        <div class="card-body">
          <h5 class="card-title">Total Revenue</h5>
          <h2 class="card-text">₹3,21,000</h2>
          <p class="text-muted">Revenue Earned</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Reports Overview -->
  <div class="row mb-4">
    <div class="col-md-12">
      <h4>Reports Overview</h4>
    </div>
  </div>

  <div class="row mb-4">
    <!-- Bookings Verified -->
    <div class="col-md-6 mb-3">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6>Bookings Verified</h6>
          <p><strong>{{ booking_verified }}</strong> bookings verified out of <strong>{{ total_bookings }}</strong></p>
          <div class="progress">
            <div class="progress-bar bg-success" role="progressbar" style="width: {{ booking_verified_percent }}%" aria-valuenow="{{ booking_verified_percent }}" aria-valuemin="0" aria-valuemax="100">{{ booking_verified_percent }}%</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Pending Bookings -->
    <div class="col-md-6 mb-3">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6>Pending Bookings</h6>
          <p><strong>{{ pending_bookings }}</strong> bookings are pending out of <strong>{{ total_bookings }}</strong></p>
          <div class="progress">
            <div class="progress-bar bg-info" role="progressbar" style="width: {{ pending_percent }}%" aria-valuenow="{{ pending_percent }}" aria-valuemin="0" aria-valuemax="100">{{ pending_percent }}%</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Popular Package -->
    <div class="col-md-6 mb-3">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6>Popular Package (This Month)</h6>
          <p><strong>{{ popular_package }}</strong> – {{ popular_count }} bookings</p>
          <div class="progress">
            <div class="progress-bar bg-warning" role="progressbar" style="width: {{ popular_percent }}%" aria-valuenow="{{ popular_percent }}" aria-valuemin="0" aria-valuemax="100">{{ popular_percent }}%</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Blocked Users -->
    <div class="col-md-6 mb-3">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6>Blocked/Inactive Users</h6>
          <p><strong>{{ blocked_users }}</strong> blocked out of <strong>{{ total_users }}</strong> users</p>
          <div class="progress">
            <div class="progress-bar bg-danger" role="progressbar" style="width: {{ blocked_percent }}%" aria-valuenow="{{ blocked_percent }}" aria-valuemin="0" aria-valuemax="100">{{ blocked_percent }}%</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="row">
    <!-- Monthly Bookings Chart -->
    <div class="col-md-6 mb-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5>Monthly Bookings</h5>
          <canvas class="line-chart" style="height: 300px;"></canvas>
        </div>
      </div>
    </div>

    <!-- Top Destinations Chart -->
    <div class="col-md-6 mb-4">
      <div class="card shadow-sm">
        <div class="card-body text-center">
          <h5>Top 5 Booked Destinations</h5>
          <canvas id="topDestinationPieChart" style="height: 300px; width: 300px;"></canvas>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
new Chart(document.querySelector('.line-chart'), {
  type: 'line',
  data: {
    labels: {{ month_labels|tojson }},
    datasets: [{
      label: 'Bookings',
      data: {{ monthly_counts|tojson }},
      borderColor: '#3498db',
      backgroundColor: 'rgba(52,152,219,0.2)',
      fill: true
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { display: true }
    }
  }
});

const ctx2 = document.getElementById('topDestinationPieChart').getContext('2d');
const pieChart = new Chart(ctx2, {
  type: 'pie',
  data: {
    labels: {{ top_package_names | tojson | safe }},
    datasets: [{
      label: 'Top Booked Packages',
      data: {{ top_package_counts | tojson | safe }},
      backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'],
      borderColor: '#fff',
      borderWidth: 2
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { position: 'bottom', labels: { boxWidth: 15, font: { size: 13 } } },
      tooltip: {
        callbacks: {
          label: function(context) {
            return `${context.label}: ${context.raw} bookings`;
          }
        }
      }
    }
  }
});
</script>

{% endblock %}
